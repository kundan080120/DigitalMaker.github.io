<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Maker</title>
  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* General Reset */
    body, h1, h2, p, input, button {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    body {
      background-color: #f4f4f9;
      height: 100%;
    }

    /* Header Styling */
    header {
      background: linear-gradient(to right, #ff7e5f, #362EFF); /* Gradient background */
      color: #87FF74;
      text-align: center;
      padding: 10px 0;
    }

    /* Website Name Styling */
    .website-name {
      font-size: 2.5rem;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .website-name .logo img {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    /* Navigation Button Styling */
    nav {
      text-align: center;
      background-color: #000000;
    }

    nav button {
      padding: 10px 7px;
      margin: 0 5px;
      font-size: 1rem;
      background-color: transparent;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    nav button:hover {
      background-color: #45a049;
    }

    /* Section Styling */
    .section {
      display: none;
      padding: 20px;
      text-align: center;
    }

    .active-section {
      display: block;
    }

    /* Footer Styling */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #202320;
      color: white;
      text-align: center;
      padding: 5px;
    }

    footer .social-icons {
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    footer .social-icons a {
      font-size: 1.5rem;
      text-decoration: none;
    }

    footer .social-icons a:hover {
      opacity: 0.7;
    }

    footer .copyright {
      margin-top: 5px;
      font-size: 13px;
    }

    /* Custom colors for social icons */
    .fab.fa-facebook {
      color: #1877F2; /* Facebook Blue */
    }

    .fab.fa-whatsapp {
      color: #25D366; /* WhatsApp Green */
    }

    .fab.fa-youtube {
      color: #FF0000; /* YouTube Red */
    }

    .fab.fa-instagram {
      background: linear-gradient(to right, #F58529, #D7008D, #8A3AB9); /* Instagram Gradient */
      color: #FF17F0; /* White color for icon */
      -webkit-background-clip: text;
      background-clip: text;
    }

    /* Custom asmani color for Twitter */
    .fab.fa-twitter {
      color: #1DA1F2; /* Twitter Sky Blue */
    }

    .earning_list {
      width: 100%;
      margin-bottom: 20px;
      padding: 1px;
      border: 1px solid #ccc;
      border-radius: 10px;
      display: flex;
      align-items: center;
      background-color: #fff;
    }

    .earning_list img {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      margin-right: 10px;
    }

    .earning_list a {
      text-decoration: none;
      background-color: #FFA15D;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      font-weight: bold;
      text-align: center;
    }

    .earning_list a:hover {
      background-color: #ff7849;
    }

/* Modal Styles */
#photoModal {
  display: none; /* Hide by default */
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8); /* Dark background overlay */
  z-index: 9999;
  justify-content: center;
  align-items: center;
}

#photoModal img {
  max-width: 90vw;
  max-height: 90vh;
  display: block;
  margin: auto;
}

#photoModal button {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: red;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 5px;
  cursor: pointer;
}

#photoModal .modal-content {
  position: relative;
  background-color: white;
  border-radius: 10px;
  padding: 20px;
}

/* Fixed Header Styling */
header {
  background: linear-gradient(to right, #ff7e5f, #362EFF); /* Gradient background */
  color: #87FF74;
  text-align: center;
  padding: 10px 0;
  position: fixed; /* Fix header at the top */
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000; /* Ensure it's above other content */
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Optional: adds shadow under the header */
}

/* Website Name Styling */
.website-name {
  font-size: 2.5rem;
  font-weight: bold;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

.website-name .logo img {
  width: 40px;
  height: 40px;
  object-fit: contain;
}

/* Navigation Styling */
nav {
  position: fixed; /* Fix nav at the top */
  top: 60px; /* Adjust for header height */
  width: 100%;
  text-align: center;
  background-color: #000000;
  z-index: 999; /* Below header */
}

nav button {
  padding: 10px 7px;
  margin: 0 5px;
  font-size: 1rem;
  background-color: transparent;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

nav button:hover {
  background-color: #45a049;
}

/* Adjust content below header */
body {
  margin-top: 120px; /* Adjust this value based on header & nav height */
}

/* Section Styling */
.section {
  display: none;
  padding: 20px;
  text-align: center;
}

.active-section {
  display: block;
}


  #account input {
    width: 100%;
    max-width: 300px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  #account button {
    padding: 4px 4px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  #account button:hover {
    background-color: #45a049;
  }

  #account div {
  }

#uploadButton{
float: right;
}

h4{
margin: 0;
}

  </style>
</head>
<body>
  <!-- Header Section -->
  <header>
    <div class="website-name">
      <div>Digital</div>
      <div class="logo">
        <img src="pic.png" alt="Logo"> <!-- Replace with your logo -->
      </div>
      <div>Maker</div>
    </div>
  </header>

  <!-- Footer Section -->
  <footer>
    <div class="social-icons">
      <!-- Social Media Icons with Custom Colors -->
      <a href="https://www.facebook.com/profile.php?id=100088573265004&mibextid=ZbWKwL" target="_blank" class="fab fa-facebook"></a>
      <a href="https://whatsapp.com/channel/0029Va60tjm1noz3FV8qXO3g" target="_blank" class="fab fa-whatsapp"></a>
      <a href="mailto:example@email.com" target="_blank" class="fas fa-envelope"></a>
      <a href="https://twitter.com" target="_blank" class="fab fa-twitter"></a>
      <a href="https://www.instagram.com" target="_blank" class="fab fa-instagram"></a>
      <a href="https://youtube.com/@digitalmakervideos?si=hgJo9LO0wBAJCprU" target="_blank" class="fab fa-youtube"></a>
    </div>
    <div class="copyright">
      <i class="fas fa-copyright"></i> 2025 Digital Maker. All rights reserved.
    </div>
  </footer>

<!-- Navigation Buttons -->
<nav>
  <button onclick="showSection('home')">Home</button>
  <button onclick="showSection('earning-apps')">Earning Apps</button>
  <button onclick="showSection('photos')">Photos</button>
  <button onclick="showSection('about')">About</button>
  <button onclick="showSection('account')">Account</button> <!-- New Button -->
</nav>

<!-- New Account Section -->
<div id="account" class="section">
  <h2>Account</h2>

<div id="userDetails" style="display: none;">
  <h3>Welcome, <span id="userName"></span>!</h3>
  <button onclick="logoutUser()">Logout</button>
</div>
  
  <!-- Register Form -->
<!-- Register Form -->
<div id="registerForm">
  <h3>Register</h3>
  <input type="text" id="registerName" placeholder="Name" required /> <!-- New Field -->
  <input type="text" id="registerUsername" placeholder="Email" required />
  <input type="password" id="registerPassword" placeholder="Password" required />
  <button onclick="registerUser()">Register</button>
</div>
  <hr>

  <!-- Login Form -->
  <div id="loginForm">
    <h3>Login</h3>
    <input type="text" id="loginUsername" placeholder="Email" required />
    <input type="password" id="loginPassword" placeholder="Password" required />
    <button onclick="loginUser()">Login</button>
  </div>
  <hr>

  <!-- Forgot Password -->
  <div id="forgotPasswordForm">
    <h3>Forgot Password</h3>
<input type="email" id="resetEmail" placeholder="Enter your email" />
<button onclick="resetPassword()">Reset Password</button>
  </div>
</div>

<!-- Sections -->
<div id="home" class="section active-section">
  <h2>Home Page</h2>
<h4>coming soon</h4>
</div>

<div id="earning-apps" class="section">
  <!-- App List -->
  <div class="earning_list">
    <img src="waki.png" alt="App Icon" style="width: 50px; height: 50px; border-radius: 10px;" />
    <div style="flex: 1; margin-left: 10px;">
      <h3 style="margin: 0; font-size: 1.2rem; color: #333;">Waki Star</h3>
      <p style="margin: 5px 0; font-size: 0.9rem; color: green;">Earn money by using this app.</p>
    </div>
    <a href="http://api.muyaparty.com/html/inviteActivity/share.php?shareUid=10163981&code=3JMSA6&lang=en-en&APPNAME=APP&coins=3000&channel=ch_copy_link" target="_blank" style="text-decoration: none; background-color: #FFA15D; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; text-align: center;">Download</a>
  </div>
</div>

<div id="photos" class="section">
  <h2>Upload Your Photo</h2>
<h4>Fist create account</h4>
  <!-- Upload photo -->
  <input type="file" id="photoUpload" />
<button id="uploadButton" onclick="uploadPhoto()">Upload</button>

  <!-- Search by Photo ID -->
  <div style="margin-top: 20px;">
    <input type="text" id="photoSearch" placeholder="Enter Photo ID" style="padding: 5px; width: 200px;" />
    <button onclick="searchPhoto()">Search</button>
  </div>
<hr >

  <!-- Photo List -->
  <div id="photoList" style="margin-top: 20px;"></div>
</div>

<div id="photoModal" onclick="closeModal()">
  <div class="modal-content">
    <button onclick="closeModal()">Close</button>
    <img id="modalImage" src="" alt="Large Photo">
  </div>
</div>

<div id="about" class="section">
  <h2>Digital Maker</h2>
  <p>Welcome to Digital Maker! Our mission is to provide valuable digital tools, applications, and solutions to help you achieve your goals. Explore our earning apps, photos section, and much more. Your success is our priority!</p><br><hr >

<p>Any problem contact now üëá</p><hr >
<center>Facebook <br> <hr > whatsapp <br><hr >instagram <br><hr >Email <br> <hr >YouTube <br><hr >twitter <br><hr >‚≠ê‚≠ê‚≠ê</center>
</div>

<!-- Modal for viewing the photo in full size -->
<div id="photoModal">
  <div style="position: relative; padding: 20px; background-color: white; border-radius: 10px;">
    <img id="modalImage" src="" alt="Large Photo" onclick="closeModal()" />
  </div>
</div>

<script type="module">
  import { deleteObject } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js";
  import { setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, updateProfile } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js";
  import { getDatabase, ref as dbRef, set, push, onValue, get, child } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCZp9iByRLuYTQEqXPGYWh6qkAeqAHN9wI",
    authDomain: "recharge-25324.firebaseapp.com",
    databaseURL: "https://recharge-25324-default-rtdb.firebaseio.com",
    projectId: "recharge-25324",
    storageBucket: "recharge-25324.appspot.com",
    messagingSenderId: "801483653705",
    appId: "1:801483653705:web:82703d20e585cffb5f3598"
  };

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app); // Initialize Firebase Authentication
const storage = getStorage(app);
const database = getDatabase(app);

async function uploadPhoto() {
  const input = document.getElementById("photoUpload");
  const file = input.files[0];
  const currentUser = auth.currentUser?.uid; // Get logged-in user's ID

  if (file) {
    const photoCountRef = dbRef(database, 'photoCount');
    const snapshot = await get(photoCountRef);
    let photoID = snapshot.exists() ? snapshot.val() + 1 : 1;

    const storageRef = ref(storage, `photos/${photoID}_${file.name}`);

    try {
      const uploadTask = await uploadBytes(storageRef, file);
      const downloadURL = await getDownloadURL(storageRef);

      // Save the URL, ID, and ownerId to the database
      await set(dbRef(database, `photos/${photoID}`), { 
        id: photoID, 
        url: downloadURL, 
        ownerId: currentUser 
      });

      await set(photoCountRef, photoID); // Update the photo count
      displayPhoto(photoID, downloadURL, currentUser); // Display the uploaded photo
      input.value = ""; // Reset input field
    } catch (error) {
      console.error("Error uploading file: ", error);
      alert("Failed to upload photo. Please try again.");
    }
  } else {
    alert("Please select a photo to upload.");
  }
}

async function deletePhoto(id, ownerId, url) {
  const currentUser = auth.currentUser?.uid;

  if (currentUser !== ownerId) {
    alert("You can only delete your own photos!");
    return;
  }

  try {
    // Delete from Storage
    const storageRef = ref(storage, url);
    await deleteObject(storageRef);

    // Delete from Database
    const photoRef = dbRef(database, `photos/${id}`);
    await set(photoRef, null);

    alert("Photo deleted successfully!");
    loadPhotos(); // Refresh the photo list
  } catch (error) {
    console.error("Error deleting photo: ", error);
    alert("Failed to delete photo. Please try again.");
  }
}



function displayPhoto(id, url, ownerId) {
  const photoList = document.getElementById("photoList");
  const currentUser = auth.currentUser?.uid; // Get logged-in user's ID

  // Photo container
  const photoContainer = document.createElement("div");
  photoContainer.style.display = "flex";
  photoContainer.style.alignItems = "center";
  photoContainer.style.marginBottom = "15px";
  photoContainer.style.border = "1px solid #ddd";
  photoContainer.style.padding = "10px";
  photoContainer.style.borderRadius = "8px";
  photoContainer.style.boxShadow = "0 2px 5px rgba(0,0,0,0.1)";

  // Photo element
  const img = document.createElement("img");
  img.src = url;
  img.style.width = "100px";
  img.style.height = "100px";
  img.style.objectFit = "cover";
  img.style.marginRight = "px";
  img.style.borderRadius = "8px";

  // Photo details container
  const detailsContainer = document.createElement("div");
  detailsContainer.style.flexGrow = "1";

  const idText = document.createElement("p");
  idText.textContent = `ID: ${id}`;
  idText.style.margin = "0";
  idText.style.fontSize = "0.9rem";
  idText.style.color = "#555";

  // Button container
  const buttonContainer = document.createElement("div");
  buttonContainer.style.display = "flex";
  buttonContainer.style.gap = "10px";

  // View Button
  const viewButton = document.createElement("button");
  viewButton.textContent = "View";
  viewButton.style.backgroundColor = "#FFA15D";
  viewButton.style.color = "white";
  viewButton.style.border = "none";
  viewButton.style.padding = "5px 10px";
  viewButton.style.borderRadius = "5px";
  viewButton.style.cursor = "pointer";
  viewButton.onclick = () => openModal(url);

  // Download Button
  const downloadButton = document.createElement("a");
  downloadButton.href = url;
  downloadButton.textContent = "Download";
  downloadButton.style.backgroundColor = "#4CAF50";
  downloadButton.style.color = "white";
  downloadButton.style.textDecoration = "none";
  downloadButton.style.padding = "5px 1px";
  downloadButton.style.borderRadius = "5px";
  downloadButton.style.cursor = "pointer";
  downloadButton.setAttribute("download", `photo_${id}`);

  // Delete Button (Only for the owner)
  if (currentUser === ownerId) {
    const deleteButton = document.createElement("button");
    deleteButton.textContent = "Delete";
    deleteButton.style.backgroundColor = "#F44336";
    deleteButton.style.color = "white";
    deleteButton.style.border = "none";
    deleteButton.style.padding = "5px 10px";
    deleteButton.style.borderRadius = "5px";
    deleteButton.style.cursor = "pointer";
    deleteButton.onclick = () => deletePhoto(id, ownerId, url); // Delete the photo
    buttonContainer.appendChild(deleteButton);
  }

  // Append elements to their respective containers
  detailsContainer.appendChild(idText);
  buttonContainer.appendChild(viewButton);
  buttonContainer.appendChild(downloadButton);
  photoContainer.appendChild(img);
  photoContainer.appendChild(detailsContainer);
  photoContainer.appendChild(buttonContainer);
  photoList.appendChild(photoContainer);
}

// Show/Hide Sections
function toggleForms(showForms) {
  document.getElementById("registerForm").style.display = showForms ? "block" : "none";
  document.getElementById("loginForm").style.display = showForms ? "block" : "none";
  document.getElementById("forgotPasswordForm").style.display = showForms ? "block" : "none";
  document.getElementById("userDetails").style.display = showForms ? "none" : "block";
}

// Register User
async function registerUser() {
  const name = document.getElementById("registerName").value.trim();
  const username = document.getElementById("registerUsername").value.trim();
  const password = document.getElementById("registerPassword").value.trim();

  if (name && username && password) {
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, username, password);
      const user = userCredential.user;

      // Update the user's display name
      await updateProfile(user, { displayName: name });

      alert("Registration successful!");
      console.log("User registered:", user);

      // Show user's name and hide forms
      document.getElementById("userName").textContent = name;
      toggleForms(false);
    } catch (error) {
      console.error("Error registering user:", error.message);
      alert("Failed to register. Please try again.");
    }
  } else {
    alert("Please fill in all fields.");
  }
}

// Login User
async function loginUser() {
  const username = document.getElementById("loginUsername").value.trim();
  const password = document.getElementById("loginPassword").value.trim();

  if (username && password) {
    try {
      const userCredential = await signInWithEmailAndPassword(auth, username, password);
      const user = userCredential.user;

      alert("Login successful!");
      console.log("User logged in:", user);

      // Show user's name and hide forms
      document.getElementById("userName").textContent = user.displayName || "User";
      toggleForms(false);
    } catch (error) {
      console.error("Error logging in:", error.message);
      alert("Failed to login. Please try again.");
    }
  } else {
    alert("Please fill in all fields.");
  }
}

// Check User Session on Page Load
function checkUserSession() {
  auth.onAuthStateChanged((user) => {
  const uploadButton = document.getElementById("uploadButton");
    if (user) {
      // User is logged in
    uploadButton.style.display = "block";
      document.getElementById("userName").textContent = user.displayName || "User";
      toggleForms(false);
    } else {
      // No user logged in
    uploadButton.style.display = "none";
      toggleForms(true);
    }
  });
}



// Set session persistence to LOCAL
setPersistence(auth, browserLocalPersistence)
  .then(() => {
    console.log("Session persistence set to LOCAL.");
    // Check user session on page load
    checkUserSession();
  })
  .catch((error) => {
    console.error("Error setting persistence:", error.message);
  });

// Logout User
async function logoutUser() {
  try {
    await auth.signOut();
    alert("Logged out successfully!");

    // Show forms and hide user details
    toggleForms(true);
  } catch (error) {
    console.error("Error logging out:", error.message);
    alert("Failed to logout. Please try again.");
  }
}



// Set session persistence
setPersistence(auth, browserLocalPersistence)
  .then(() => {
    console.log("Session persistence set to LOCAL.");
    // Check user session on page load
    checkUserSession();
  })
  .catch((error) => {
    console.error("Error setting persistence:", error.message);
  });

// Reset Password
async function resetPassword() {
  const email = document.getElementById("resetEmail").value.trim();
  if (email) {
    try {
      await sendPasswordResetEmail(auth, email);
      alert("Password reset email sent!");
    } catch (error) {
      console.error("Error resetting password:", error.message);
      alert("Failed to send reset email. Please try again.");
    }
  } else {
    alert("Please enter your email.");
  }
}

  // Search Photo Functionality
  async function searchPhoto() {
    const photoSearch = document.getElementById("photoSearch").value.trim();
    const photoList = document.getElementById("photoList");
    photoList.innerHTML = ""; // Clear previous results

    if (!photoSearch) {
      alert("Please enter a photo ID to search.");
      return;
    }

    try {
      console.log(`Searching for photo with ID: ${photoSearch}`); // Debug log

      const databaseRef = dbRef(database); // Root database reference
      const snapshot = await get(child(databaseRef, `photos/${photoSearch}`)); // Fetch data

      if (snapshot.exists()) {
        const photoData = snapshot.val();
        console.log("Photo data:", photoData); // Debug log to check the data

        // Check if the photoData contains the necessary fields
        if (photoData && photoData.url && photoData.id) {
          console.log("Photo found: ", photoData); // Debug log
          displayPhoto(photoData.id, photoData.url); // Display the searched photo first
        } else {
          console.error("Photo data is incomplete:", photoData); // Log incomplete data
          alert("Photo data is incomplete or invalid.");
        }
      } else {
        console.log("No photo found with the provided ID.");
        alert("No photo found with the provided ID.");
      }

      // Fetch and display all photos
      const photosRef = dbRef(database, 'photos');
      onValue(photosRef, (snapshot) => {
        snapshot.forEach((childSnapshot) => {
          const photoData = childSnapshot.val();
          if (photoData && photoData.url) {
            // Only display photos that are not the one already displayed on top
            if (photoData.id !== photoSearch) {
              displayPhoto(photoData.id, photoData.url);
            }
          }
        });
      });
    } catch (error) {
      console.error("Error searching for photo: ", error.message);
      alert("An error occurred while searching for the photo.");
    }
  }

  function openModal(url) {
    const modal = document.getElementById("photoModal");
    const modalImage = document.getElementById("modalImage");

    modal.style.display = "flex"; // Show the modal
    modalImage.src = url; // Set the image source to the URL passed to the function
  }

  function closeModal() {
    const modal = document.getElementById("photoModal");
    modal.style.display = "none"; // Hide the modal
  }

  // Fetch all photos on page load
async function loadPhotos() {
  const photoList = document.getElementById("photoList");
  photoList.innerHTML = ""; // Clear the list before loading photos

  const currentUser = auth.currentUser?.uid; // Get logged-in user's ID
  const photosRef = dbRef(database, "photos");

  try {
    const snapshot = await get(photosRef);

    if (snapshot.exists()) {
      const photos = snapshot.val();

      for (const id in photos) {
        const { url, ownerId } = photos[id];
        displayPhoto(id, url, ownerId);
      }
    } else {
      photoList.innerHTML = "<p>No photos available.</p>";
    }
  } catch (error) {
    console.error("Error loading photos: ", error);
    alert("Failed to load photos. Please try again.");
  }
}

  window.onload = loadPhotos;

  // Expose functions to global scope
  window.uploadPhoto = uploadPhoto;
  window.searchPhoto = searchPhoto;
  window.registerUser = registerUser;
  window.loginUser = loginUser;
  window.logoutUser = logoutUser;
  window.resetPassword = resetPassword;
  window.openModal = openModal;
  window.closeModal = closeModal;

</script>

<script>
  function showSection(sectionId) {
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => {
      section.classList.remove('active-section'); // Hide all sections
    });

    const activeSection = document.getElementById(sectionId);
    activeSection.classList.add('active-section'); // Show the selected section
  }
</script>
</body>
</html>
